{
	"name": "DF_PLN_ENGINEERING_DRAWING",
	"properties": {
		"folder": {
			"name": "DWH/Facts"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_PLN_ENGINEERING_DRAWING_TRG",
						"type": "DatasetReference"
					},
					"name": "source1",
					"description": "Import data from DS_O_PLN_DRAWING_DETAIL_DRAW_STG_TRG"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_PLN_ENGINEERING_DRAWING_TRG",
						"type": "DatasetReference"
					},
					"name": "sink1",
					"description": "Export data to "
				}
			],
			"transformations": [
				{
					"name": "surrogateKey1"
				},
				{
					"name": "derivedColumn1"
				}
			],
			"scriptLines": [
				"parameters{",
				"     MAX_ID as integer (0)",
				"}",
				"source(output(",
				"          PROJECT_ID as integer,",
				"          PROJECT_IDENTIFIER as string,",
				"          SBU_ID as integer,",
				"          Upload_Date as date,",
				"          tower as string,",
				"          Type as string,",
				"          Villa_Type as string,",
				"          Category as string,",
				"          Drawing_Number as string,",
				"          Drawing_Title as string,",
				"          Scheduled_Date as string,",
				"          {PNCA_commitment } as string,",
				"          R0 as string,",
				"          R0_Trans_Id as string,",
				"          R1 as string,",
				"          R1_Trans_Id as string,",
				"          R2 as string,",
				"          R2_Trans_Id as string,",
				"          R3 as string,",
				"          R3_Trans_Id as string,",
				"          R4 as string,",
				"          R4_Trans_Id as string,",
				"          R5 as string,",
				"          R5_Trans_Id as string,",
				"          R6 as string,",
				"          R6_Trans_Id as string,",
				"          R7 as string,",
				"          R7_Trans_Id as string,",
				"          R8 as string,",
				"          R8_Trans_Id as string,",
				"          R9 as string,",
				"          R9_Trans_Id as string,",
				"          R10 as string,",
				"          R10_Trans_Id as string,",
				"          R11 as string,",
				"          R11_Trans_Id as string,",
				"          R12 as string,",
				"          R12_Trans_Id as string,",
				"          R13 as string,",
				"          R13_Trans_Id as string,",
				"          R14 as string,",
				"          R14_Trans_Id as string,",
				"          R15 as string,",
				"          R15_Trans_Id as string,",
				"          R16 as string,",
				"          R16_Trans_Id as string,",
				"          R17 as string,",
				"          R17_Trans_Id as string,",
				"          R18 as string,",
				"          R18_Trans_Id as string,",
				"          R19 as string,",
				"          R19_Trans_Id as string,",
				"          R20 as string,",
				"          R20_Trans_Id as string,",
				"          R21 as string,",
				"          R21_Trans_Id as string,",
				"          R22 as string,",
				"          R22_Trans_Id as string,",
				"          R23 as string,",
				"          R23_Trans_Id as string,",
				"          R24 as string,",
				"          R24_Trans_Id as string,",
				"          R25 as string,",
				"          R25_Trans_Id as string",
				"     ),",
				"     allowSchemaDrift: false,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT \\n          P.Sort_ID as PROJECT_ID,\\n           PROJECT_ID as PROJECT_IDENTIFIER,\\n          SM.SBU_MAP_ID AS SBU_ID,\\n          CAST(upload_time AS DATE) AS Upload_Date,\\n        [tower],\\n        [Type],\\n        [Villa Type] AS [Villa_Type],\\n        Category,\\n        [Drawing Number] AS [Drawing_Number],\\n        [Drawing Title] AS [Drawing_Title],\\n        NULLIF([Scheduled Date],\\'\\') AS \\'Scheduled_Date\\',\\n        NULLIF([PNCA commitment],\\'\\') AS \\'PNCA_commitment \\',\\n        NULLIF(R0,\\'\\') AS R0,\\n        NULLIF([R0-Trans_Id],\\'\\') AS [R0_Trans_Id],\\n        NULLIF(R1,\\'\\') AS R1,\\n        NULLIF([R1-Trans_Id],\\'\\') AS [R1_Trans_Id],\\n        NULLIF(R2,\\'\\') AS R2,\\n        NULLIF([R2-Trans_Id],\\'\\') AS [R2_Trans_Id],\\n        NULLIF(R3,\\'\\') AS R3,\\n        NULLIF([R3-Trans_Id],\\'\\') AS [R3_Trans_Id],\\n        NULLIF(R4,\\'\\') AS R4,\\n        NULLIF([R4-Trans_Id],\\'\\') AS [R4_Trans_Id],\\n        NULLIF(R5,\\'\\') AS R5,\\n        NULLIF([R5-Trans_Id],\\'\\') AS [R5_Trans_Id],\\n        NULLIF(R6,\\'\\') AS R6,\\n        NULLIF([R6-Trans_Id],\\'\\') AS [R6_Trans_Id],\\n        NULLIF(R7,\\'\\') AS R7,\\n        NULLIF([R7-Trans_Id],\\'\\') AS [R7_Trans_Id],\\n        NULLIF(R8,\\'\\') AS R8,\\n        NULLIF([R8-Trans_Id],\\'\\') AS [R8_Trans_Id],\\n        NULLIF(R9,\\'\\') AS R9,\\n        NULLIF([R9-Trans_Id],\\'\\') AS [R9_Trans_Id],\\n        NULLIF(R10,\\'\\') AS R10,\\n        NULLIF([R10-Trans_Id],\\'\\') AS [R10_Trans_Id],\\n        NULLIF(R11,\\'\\') AS R11,\\n        NULLIF([R11-Trans_Id],\\'\\') AS [R11_Trans_Id],\\n        NULLIF(R12,\\'\\') AS R12,\\n        NULLIF([R12-Trans_Id],\\'\\') AS [R12_Trans_Id],\\n        NULLIF(R11,\\'\\') AS R13,\\n        NULLIF([R13-Trans_Id],\\'\\') AS [R13_Trans_Id],\\n        NULLIF(R12,\\'\\') AS R14,\\n        NULLIF([R14-Trans_Id],\\'\\') AS [R14_Trans_Id],\\n        NULLIF(R13,\\'\\') AS R15,\\n        NULLIF([R15-Trans_Id],\\'\\') AS [R15_Trans_Id],\\n        NULLIF(R16,\\'\\') AS R16,\\n        NULLIF([R16-Trans_Id],\\'\\') AS [R16_Trans_Id],\\n        NULLIF(R17,\\'\\') AS R17,\\n        NULLIF([R17-Trans_Id],\\'\\') AS [R17_Trans_Id],\\n        NULLIF(R18,\\'\\') AS R18,\\n        NULLIF([R18-Trans_Id],\\'\\') AS [R18_Trans_Id],\\n        NULLIF(R19,\\'\\') AS R19,\\n        NULLIF([R19-Trans_Id],\\'\\') AS [R19_Trans_Id],\\n        NULLIF(R20,\\'\\') AS R20,\\n        NULLIF([R20-Trans_Id],\\'\\') AS [R20_Trans_Id],\\n        NULLIF(R21,\\'\\') AS R21,\\n        NULLIF([R21-Trans_Id],\\'\\') AS [R21_Trans_Id],\\n        NULLIF(R22,\\'\\') AS R22,\\n        NULLIF([R22-Trans_Id],\\'\\') AS [R22_Trans_Id],\\n        NULLIF(R23,\\'\\') AS R23,\\n        NULLIF([R23-Trans_Id],\\'\\') AS [R23_Trans_Id],\\n        NULLIF(R24,\\'\\') AS R24,\\n        NULLIF([R24-Trans_Id],\\'\\') AS [R24_Trans_Id],\\n        NULLIF(R25,\\'\\') AS R25,\\n        NULLIF([R25-Trans_Id],\\'\\') AS [R25_Trans_Id]\\nFROM ( SELECT * , DENSE_RANK () OVER (PARTITION BY  project_id ORDER BY  CAST(upload_time AS DATE) DESC) Project_Udate_DRANK\\n        FROM STG.O_PLN_DRAWING_DETAIL_DRAW_STG\\n    WHERE ([Type] IS NOT NULL AND TRIM([Type]) NOT IN (\\'\\')) \\n     ) AB \\n     LEFT JOIN [DWH].[PROJECTS_NEW_DIM] P\\n      ON          AB.PROJECT_ID=P.PROJECT_IDENTIFIER \\n     LEFT JOIN [DWH].[PLN_SBU_MAPPING_DIM] SM\\n     ON          AB.SBU_ID=SM.SBU_IDENTIFIER\\n',",
				"     format: 'query',",
				"     staged: true) ~> source1",
				"source1 keyGenerate(output(SurrogateKey_ID as long),",
				"     startAt: 1L,",
				"     stepValue: 1L) ~> surrogateKey1",
				"surrogateKey1 derive(ID = SurrogateKey_ID+$MAX_ID,",
				"          LoadDateTime = currentUTC()) ~> derivedColumn1",
				"derivedColumn1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          ID as integer,",
				"          Project_ID as integer,",
				"          Project_Identifier as string,",
				"          SBU_ID as integer,",
				"          Tower as string,",
				"          Type as string,",
				"          Villa_Type as string,",
				"          Category as string,",
				"          Drawing_Number as string,",
				"          Drawing_Title as string,",
				"          Scheduled_Date as string,",
				"          PNCA_commitment as string,",
				"          R0 as string,",
				"          R0_Trans_Id as string,",
				"          R1 as string,",
				"          R1_Trans_Id as string,",
				"          R2 as string,",
				"          R2_Trans_Id as string,",
				"          R3 as string,",
				"          R3_Trans_Id as string,",
				"          R4 as string,",
				"          R4_Trans_Id as string,",
				"          R5 as string,",
				"          R5_Trans_Id as string,",
				"          R6 as string,",
				"          R6_Trans_Id as string,",
				"          R7 as string,",
				"          R7_Trans_Id as string,",
				"          R8 as string,",
				"          R8_Trans_Id as string,",
				"          R9 as string,",
				"          R9_Trans_Id as string,",
				"          R10 as string,",
				"          R10_Trans_Id as string,",
				"          R11 as string,",
				"          R11_Trans_Id as string,",
				"          R12 as string,",
				"          R12_Trans_Id as string,",
				"          R13 as string,",
				"          R13_Trans_Id as string,",
				"          R14 as string,",
				"          R14_Trans_Id as string,",
				"          R15 as string,",
				"          R15_Trans_Id as string,",
				"          R16 as string,",
				"          R16_Trans_Id as string,",
				"          R17 as string,",
				"          R17_Trans_Id as string,",
				"          R18 as string,",
				"          R18_Trans_Id as string,",
				"          R19 as string,",
				"          R19_Trans_Id as string,",
				"          R20 as string,",
				"          R20_Trans_Id as string,",
				"          R21 as string,",
				"          R21_Trans_Id as string,",
				"          R22 as string,",
				"          R22_Trans_Id as string,",
				"          R23 as string,",
				"          R23_Trans_Id as string,",
				"          R24 as string,",
				"          R24_Trans_Id as string,",
				"          R25 as string,",
				"          R25_Trans_Id as string,",
				"          Update_Date as date,",
				"          LoadDateTime as timestamp",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     staged: true,",
				"     allowCopyCommand: true,",
				"     preSQLs:['TRUNCATE TABLE [DWH].[PLN_ENGINEERING_DRAWING_FACT];'],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          ID,",
				"          Project_ID = PROJECT_ID,",
				"          SBU_ID,",
				"          Tower = tower,",
				"          Type,",
				"          Villa_Type,",
				"          Category,",
				"          Drawing_Number,",
				"          Drawing_Title,",
				"          Scheduled_Date,",
				"          PNCA_commitment = {PNCA_commitment },",
				"          R0,",
				"          R0_Trans_Id,",
				"          R1,",
				"          R1_Trans_Id,",
				"          R2,",
				"          R2_Trans_Id,",
				"          R3,",
				"          R3_Trans_Id,",
				"          R4,",
				"          R4_Trans_Id,",
				"          R5,",
				"          R5_Trans_Id,",
				"          R6,",
				"          R6_Trans_Id,",
				"          R7,",
				"          R7_Trans_Id,",
				"          R8,",
				"          R8_Trans_Id,",
				"          R9,",
				"          R9_Trans_Id,",
				"          R10,",
				"          R10_Trans_Id,",
				"          R11,",
				"          R11_Trans_Id,",
				"          R12,",
				"          R12_Trans_Id,",
				"          R13,",
				"          R13_Trans_Id,",
				"          R14,",
				"          R14_Trans_Id,",
				"          R15,",
				"          R15_Trans_Id,",
				"          R16,",
				"          R16_Trans_Id,",
				"          R17,",
				"          R17_Trans_Id,",
				"          R18,",
				"          R18_Trans_Id,",
				"          R19,",
				"          R19_Trans_Id,",
				"          R20,",
				"          R20_Trans_Id,",
				"          R21,",
				"          R21_Trans_Id,",
				"          R22,",
				"          R22_Trans_Id,",
				"          R23,",
				"          R23_Trans_Id,",
				"          R24,",
				"          R24_Trans_Id,",
				"          R25,",
				"          R25_Trans_Id,",
				"          Update_Date = Upload_Date,",
				"          LoadDateTime,",
				"          Project_Identifier = PROJECT_IDENTIFIER",
				"     )) ~> sink1"
			]
		}
	}
}