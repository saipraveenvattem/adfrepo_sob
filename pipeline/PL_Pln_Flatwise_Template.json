{
	"name": "PL_Pln_Flatwise_Template",
	"properties": {
		"activities": [
			{
				"name": "Dry Area Template",
				"type": "Lookup",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "AzureMySqlSource",
						"query": "TRUNCATE TABLE f_pln_dryarea;\r\nINSERT INTO f_pln_dryarea\r\nWITH PRE_STAGGING AS(\r\n\r\n    select\r\n\r\n        DATE(O_PLN_DRYAREA_RAW.upload_time) AS Upload_Date,\r\n\r\n        O_PLN_DRYAREA_RAW.project_id,\r\n\r\n        O_PLN_DRYAREA_RAW.tower,\r\n\r\n        O_PLN_DRYAREA_RAW.`Level`,\r\n\r\n        O_PLN_DRYAREA_RAW.Flat,\r\n\r\n        'Dry Area' AS sclicer,\r\n\r\n        Column_Name.*,\r\n\r\n        O_PLN_DRYAREA_MAP.ACTIVITY_ID,\r\n\r\n        O_PLN_DRYAREA_MAP.SBU_ID,\r\n\r\n        O_PLN_DRYAREA_MAP.Category,\r\n\r\n        DENSE_RANK () OVER (PARTITION BY  project_id\r\n\r\n                            ORDER BY  DATE(upload_time) DESC\r\n\r\n                            )    AS Project_Udate_DRANK\r\n\r\n    from O_PLN_DRYAREA_RAW\r\n\r\n    cross join lateral (\r\n\r\n            SELECT     `HSE Clearance for Deshuttering`              ,               'HSE Clearance for Deshuttering'\r\n\r\n                                                                UNION ALL SELECT           `MEP Riser Works`           ,               'MEP Riser Works'\r\n\r\n                                                                UNION ALL SELECT           `LPG Pipe`           ,               'LPG Pipe'\r\n\r\n                                                                UNION ALL SELECT           `Blockwork Layout Marking`        ,               'Blockwork Layout Marking'\r\n\r\n                                                                UNION ALL SELECT           `Blockwork First Layer`   ,               'Blockwork First Layer'\r\n\r\n                                                                UNION ALL SELECT           `Blockwork with 1mtr marking`  ,               'Blockwork with 1mtr marking'\r\n\r\n                                                                UNION ALL SELECT           `GI Lintel`             ,               'GI Lintel'\r\n\r\n                                                                UNION ALL SELECT           `RCC Lintel / Stiffener`   ,               'RCC Lintel / Stiffener'\r\n\r\n                                                                UNION ALL SELECT           `Above Lintel Block Work`             ,               'Above Lintel Block Work'\r\n\r\n                                                                UNION ALL SELECT           `Head Restraints Installation`      ,               'Head Restraints Installation'\r\n\r\n                                                                UNION ALL SELECT           `Fire Sealant Works & PU Foam Works`  ,               'Fire Sealant Works & PU Foam Works'\r\n\r\n                                                                UNION ALL SELECT           `MEP Marking for HL Builders Work`        ,               'MEP Marking for HL Builders Work'\r\n\r\n                                                                UNION ALL SELECT           `Blockwork Cutting for MEP Services`      ,               'Blockwork Cutting for MEP Services'\r\n\r\n                                                                UNION ALL SELECT           `MEP Wall Marking for Cutting & Chasing`             ,               'MEP Wall Marking for Cutting & Chasing'\r\n\r\n                                                                UNION ALL SELECT           `Bull Marking for Plaster`              ,               'Bull Marking for Plaster'\r\n\r\n                                                                UNION ALL SELECT           `Sub Frame`        ,               'Sub Frame'\r\n\r\n                                                                UNION ALL SELECT           `Corner Bead Fixing`        ,               'Corner Bead Fixing'\r\n\r\n                                                                UNION ALL SELECT           `Cutting & Chasing`          ,               'Cutting & Chasing'\r\n\r\n                                                                UNION ALL SELECT           `MEP Plastering Clearance (Box fixing & Pipe setting)`      ,                'MEP Plastering Clearance (Box fixing & Pipe setting)'\r\n\r\n                                                                UNION ALL SELECT           `ONU, DB & All MEP works Installation`  ,               'ONU, DB & All MEP works Installation'\r\n\r\n                                                                UNION ALL SELECT           `ONU, DB & All MEP works Packing`         ,               'ONU, DB & All MEP works Packing'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area Plaster`             ,               'Dry Area Plaster'\r\n\r\n                                                                UNION ALL SELECT           `Plastering Clearance with 1 Meter Marking`        ,                'Plastering Clearance with 1 Meter Marking'\r\n\r\n                                                                UNION ALL SELECT           `Center line marking for Facade Installation`         ,                'Center line marking for Facade Installation'\r\n\r\n                                                                UNION ALL SELECT           `UCW-Starter Gutter`     ,               'UCW-Starter Gutter'\r\n\r\n                                                                UNION ALL SELECT           `UCW-Brackets` ,               'UCW-Brackets'\r\n\r\n                                                                UNION ALL SELECT           `UCW-Panels`    ,               'UCW-Panels'\r\n\r\n                                                                UNION ALL SELECT           `UCW-Alignment`            ,               'UCW-Alignment'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area Tile Marking`  ,               'Dry Area Tile Marking'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area Bore Packing` ,               'Dry Area Bore Packing'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area Screed`             ,               'Dry Area Screed'\r\n\r\n                                                                UNION ALL SELECT           `Screed Curing`  ,               'Screed Curing'\r\n\r\n                                                                UNION ALL SELECT           `Primer,Stucco banding` ,               'Primer,Stucco banding'\r\n\r\n                                                                UNION ALL SELECT           `Bulk Head`         ,               'Bulk Head'\r\n\r\n                                                                UNION ALL SELECT           `MEP H/L Wiring`              ,               'MEP H/L Wiring'\r\n\r\n                                                                UNION ALL SELECT           `MEP H/L Framing Clearance`      ,               'MEP H/L Framing Clearance'\r\n\r\n                                                                UNION ALL SELECT           `Fire Sealant works around ducts`             ,               'Fire Sealant works around ducts'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area FC Framing`    ,               'Dry Area FC Framing'\r\n\r\n                                                                UNION ALL SELECT           `Wardrobe Nib wall`        ,               'Wardrobe Nib wall'\r\n\r\n                                                                UNION ALL SELECT           `MEP H/L Boarding Clearance`    ,               'MEP H/L Boarding Clearance'\r\n\r\n                                                                UNION ALL SELECT           `FC Boarding with Joint Taping`  ,               'FC Boarding with Joint Taping'\r\n\r\n                                                                UNION ALL SELECT           `Primer Ceiling` ,               'Primer Ceiling'\r\n\r\n                                                                UNION ALL SELECT           `Stucco 1st Coat Ceiling` ,               'Stucco 1st Coat Ceiling'\r\n\r\n                                                                UNION ALL SELECT           `Stucco 2nd Coat Ceiling`               ,               'Stucco 2nd Coat Ceiling'\r\n\r\n                                                                UNION ALL SELECT           `First Coat Paint Ceiling` ,               'First Coat Paint Ceiling'\r\n\r\n                                                                UNION ALL SELECT           `Main Door Threshold`   ,               'Main Door Threshold'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area Floor Tiling`     ,               'Dry Area Floor Tiling'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area Skirting`            ,               'Dry Area Skirting'\r\n\r\n                                                                UNION ALL SELECT           `POP Above Skirting`       ,               'POP Above Skirting'\r\n\r\n                                                                UNION ALL SELECT           `Hinge Door Box Installation`       ,               'Hinge Door Box Installation'\r\n\r\n                                                                UNION ALL SELECT           `Screed near Hinge Door`              ,               'Screed near Hinge Door'\r\n\r\n                                                                UNION ALL SELECT           `Hinge Door Frame Installation`  ,               'Hinge Door Frame Installation'\r\n\r\n                                                                UNION ALL SELECT           `Curtain Wall Box Section`            ,               'Curtain Wall Box Section'\r\n\r\n                                                                UNION ALL SELECT           `Curtain Wall Frame Installation`               ,               'Curtain Wall Frame Installation'\r\n\r\n                                                                UNION ALL SELECT           `Curtain Wall Glass Installation`  ,               'Curtain Wall Glass Installation'\r\n\r\n                                                                UNION ALL SELECT           `UCW-GI Sheet Installation - Wall`             ,               'UCW-GI Sheet Installation - Wall'\r\n\r\n                                                                UNION ALL SELECT           `UCW-GI Sheet Installation - Floor`            ,               'UCW-GI Sheet Installation - Floor'\r\n\r\n                                                                UNION ALL SELECT           `Screed near Curtain Wall`            ,               'Screed near Curtain Wall'\r\n\r\n                                                                UNION ALL SELECT           `Sliding Door Box Installation`     ,               'Sliding Door Box Installation'\r\n\r\n                                                                UNION ALL SELECT           `Sliding Door Frame Installation`                ,               'Sliding Door Frame Installation'\r\n\r\n                                                                UNION ALL SELECT           `Screed near Sliding Door`            ,               'Screed near Sliding Door'\r\n\r\n                                                                UNION ALL SELECT           `Left Over Tile Installation`           ,               'Left Over Tile Installation'\r\n\r\n                                                                UNION ALL SELECT           `Left Over Skirting`           ,               'Left Over Skirting'\r\n\r\n                                                                UNION ALL SELECT           `Tile Grouting`   ,               'Tile Grouting'\r\n\r\n                                                                UNION ALL SELECT           `Tile Silicone Works`        ,               'Tile Silicone Works'\r\n\r\n                                                                UNION ALL SELECT           `Curtain Wall Mullion`    ,               'Curtain Wall Mullion'\r\n\r\n                                                                UNION ALL SELECT           `Curtain Wall Flashing Installation`            ,               'Curtain Wall Flashing Installation'\r\n\r\n                                                                UNION ALL SELECT           `Curtain Wall Silicone`    ,               'Curtain Wall Silicone'\r\n\r\n                                                                UNION ALL SELECT           `UCW-Firestop and Silicone`        ,               'UCW-Firestop and Silicone'\r\n\r\n                                                                UNION ALL SELECT           `UCW-GI Flashing`            ,               'UCW-GI Flashing'\r\n\r\n                                                                UNION ALL SELECT           `Hinge Door Glass Installation`    ,               'Hinge Door Glass Installation'\r\n\r\n                                                                UNION ALL SELECT           `Hinge Door Internal Silicone`      ,               'Hinge Door Internal Silicone'\r\n\r\n                                                                UNION ALL SELECT           `Hinge Door Alignment` ,               'Hinge Door Alignment'\r\n\r\n                                                                UNION ALL SELECT           `Hinge Door External Silicone`     ,               'Hinge Door External Silicone'\r\n\r\n                                                                UNION ALL SELECT           `Sliding Door Glass Installation`  ,               'Sliding Door Glass Installation'\r\n\r\n                                                                UNION ALL SELECT           `Sliding Door Internal Silicone`    ,               'Sliding Door Internal Silicone'\r\n\r\n                                                                UNION ALL SELECT           `Sliding Door Alignment`               ,               'Sliding Door Alignment'\r\n\r\n                                                                UNION ALL SELECT           `Sliding Door External Silicone`   ,               'Sliding Door External Silicone'\r\n\r\n                                                                UNION ALL SELECT           `Window Jamb,Corner,Pelmet Area, Shadow Angle POP Works`  ,               'Window Jamb,Corner,Pelmet Area, Shadow Angle POP Works'\r\n\r\n                                                                UNION ALL SELECT           `Wall Stucco 1st Coat`    ,               'Wall Stucco 1st Coat'\r\n\r\n                                                                UNION ALL SELECT           `Wall stucco 2nd coat`    ,               'Wall stucco 2nd coat'\r\n\r\n                                                                UNION ALL SELECT           `Wall Paint 1st Coat`       ,               'Wall Paint 1st Coat'\r\n\r\n                                                                UNION ALL SELECT           `Door - Frame Installation`            ,               'Door - Frame Installation'\r\n\r\n                                                                UNION ALL SELECT           `Door - Architrave Installation`    ,               'Door - Architrave Installation'\r\n\r\n                                                                UNION ALL SELECT           `Door - Shutter Installation`         ,               'Door - Shutter Installation'\r\n\r\n                                                                UNION ALL SELECT           `Door - Ironmongery Installation`              ,               'Door - Ironmongery Installation'\r\n\r\n                                                                UNION ALL SELECT           `Door - Silicone Works`  ,               'Door - Silicone Works'\r\n\r\n                                                                UNION ALL SELECT           `Cut piece Skirting near Door`     ,               'Cut piece Skirting near Door'\r\n\r\n                                                                UNION ALL SELECT           `Gas Meter Installation` ,               'Gas Meter Installation'\r\n\r\n                                                                UNION ALL SELECT           `MEP Kitchen Appliances`             ,               'MEP Kitchen Appliances'\r\n\r\n                                                                UNION ALL SELECT           `Wardrobe Carcass Installation`  ,               'Wardrobe Carcass Installation'\r\n\r\n                                                                UNION ALL SELECT           `Wardrobe Shutter Installation`  ,               'Wardrobe Shutter Installation'\r\n\r\n                                                                UNION ALL SELECT           `Wardrobe Silicone Works`          ,               'Wardrobe Silicone Works'\r\n\r\n                                                                UNION ALL SELECT           `Cut piece Skirting near Wardrobe`           ,               'Cut piece Skirting near Wardrobe'\r\n\r\n                                                                UNION ALL SELECT           `Air Balancing for FCU`   ,               'Air Balancing for FCU'\r\n\r\n                                                                UNION ALL SELECT           `FCU Closure Clearance` ,               'FCU Closure Clearance'\r\n\r\n                                                                UNION ALL SELECT           `VCD Closure - FCU`         ,               'VCD Closure - FCU'\r\n\r\n                                                                UNION ALL SELECT           `Air Balancing for FAHU`                ,               'Air Balancing for FAHU'\r\n\r\n                                                                UNION ALL SELECT           `FAHU Closure Clearance`             ,               'FAHU Closure Clearance'\r\n\r\n                                                                UNION ALL SELECT           `VCD Closure - FAHU`     ,               'VCD Closure - FAHU'\r\n\r\n                                                                UNION ALL SELECT           `Final Fixtures Installation`           ,               'Final Fixtures Installation'\r\n\r\n                                                                UNION ALL SELECT           `Access Panel Final Coat and Installation`               ,                'Access Panel Final Coat and Installation'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area Final Coat Preparation`              ,               'Dry Area Final Coat Preparation'\r\n\r\n                                                                UNION ALL SELECT           `Dry Area Final Coat Paint`            ,               'Dry Area Final Coat Paint'\r\n\r\n                                                                UNION ALL SELECT           `Thermostat Cover Installation`  ,               'Thermostat Cover Installation'\r\n\r\n                                                                UNION ALL SELECT           `Intercom Cover Installation`       ,               'Intercom Cover Installation'\r\n\r\n                                                                UNION ALL SELECT           `ONU & DB Panel Door` ,               'ONU & DB Panel Door'\r\n\r\n                                                                UNION ALL SELECT           `Switch socket cover Installation`               ,               'Switch socket cover Installation'\r\n\r\n                                                                )\r\n\r\n        as Column_Name(value,Type_of_work)\r\n\r\n    JOIN O_PLN_DRYAREA_MAP\r\n\r\n    ON Column_Name.Type_of_work = O_PLN_DRYAREA_MAP.ACTIVITY_SEQUENCE\r\n\r\n    WHERE value IS NOT NULL )\r\n\r\nSELECT\r\n\r\n    PS.Upload_Date   ,\r\n\r\n    PS.project_id    ,\r\n\r\n    PS.tower    ,\r\n\r\n    PS.`Level`    ,\r\n\r\n   PS.Flat    ,\r\n\r\n    PS.sclicer    ,\r\n\r\n    CASE\r\n\r\n        WHEN PS.value IN ('','NA','-') THEN '0%'\r\n\r\n        ELSE PS.value\r\n\r\n    END AS value,\r\n\r\n    PS.Type_of_work    ,\r\n\r\n    PS.ACTIVITY_ID    ,\r\n\r\n    PS.SBU_ID    ,\r\n\r\n    PS.Category    ,\r\n\r\n    OLMA.level_map\r\n\r\nFROM PRE_STAGGING PS\r\n\r\n    LEFT JOIN O_LEVEL_MAP_ALL OLMA\r\n\r\n        ON PS.`Level` = OLMA.`level` WHERE Project_Udate_DRANK = 1;\r\n\r\n        /**/\r\n\r\n        SELECT 1;",
						"queryTimeout": "02:00:00"
					},
					"dataset": {
						"referenceName": "DS_MySQL_Data_Loads_DB",
						"type": "DatasetReference"
					}
				}
			},
			{
				"name": "Kitchen Area Template",
				"type": "Lookup",
				"dependsOn": [
					{
						"activity": "Dry Area Template",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "AzureMySqlSource",
						"query": "TRUNCATE TABLE f_pln_kitchenarea;\r\nINSERT INTO f_pln_kitchenarea\r\nWITH PRE_STAGGING AS(\r\n\r\n    SELECT\r\n\r\n        DATE(O_PLN_KITCHENAREA_RAW.upload_time) AS Upload_Date,\r\n\r\n        O_PLN_KITCHENAREA_RAW.project_id,\r\n\r\n        O_PLN_KITCHENAREA_RAW.tower,\r\n\r\n        O_PLN_KITCHENAREA_RAW.`Level`,\r\n\r\n        O_PLN_KITCHENAREA_RAW.Flat,\r\n\r\n        'Kitchen Area' AS sclicer,\r\n\r\n        Column_Name.*,\r\n\r\n        O_PLN_KITCHENAREA_MAP.ACTIVITY_ID,\r\n\r\n        O_PLN_KITCHENAREA_MAP.SBU_ID,\r\n\r\n        O_PLN_KITCHENAREA_MAP.Category,\r\n\r\n        DENSE_RANK () OVER (PARTITION BY  project_id\r\n\r\n                            ORDER BY  DATE(upload_time) DESC\r\n\r\n                            )   AS  Project_Udate_DRANK\r\n\r\n    from O_PLN_KITCHENAREA_RAW\r\n\r\n    cross join lateral (\r\n\r\n            SELECT     `Kitchen Area Plaster`     ,               'Kitchen Area Plaster'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen / Utility Framing Clearance`        ,                'Kitchen / Utility Framing Clearance'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen / Utility Framing`             ,               'Kitchen / Utility Framing'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen / Utility Boarding Clearance`      ,                'Kitchen / Utility Boarding Clearance'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen / Utility Boarding`           ,               'Kitchen / Utility Boarding'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen Wall Tile`            ,               'Kitchen Wall Tile'\r\n\r\n                                                                                UNION ALL SELECT           `MEP Box Fixing`               ,               'MEP Box Fixing'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen Cabinet`             ,               'Kitchen Cabinet'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen Counter Plywood`          ,               'Kitchen Counter Plywood'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen Counter Top`    ,               'Kitchen Counter Top'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen Counter Top Skirting`    ,               'Kitchen Counter Top Skirting'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen Cabinet Grouting`           ,               'Kitchen Cabinet Grouting'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen Cabinet Silicone`             ,               'Kitchen Cabinet Silicone'\r\n\r\n                                                                                UNION ALL SELECT           `MEP Fixtures for Kitchen Cabinet`            ,               'MEP Fixtures for Kitchen Cabinet'\r\n\r\n                                                                                UNION ALL SELECT           `Kitchen Appliances`       ,               'Kitchen Appliances'\r\n\r\n                                                                                )\r\n\r\n        as Column_Name(value,Type_of_work)\r\n\r\n    JOIN O_PLN_KITCHENAREA_MAP\r\n\r\n    ON Column_Name.Type_of_work = O_PLN_KITCHENAREA_MAP.ACTIVITY_SEQUENCE\r\n\r\n    WHERE value IS NOT NULL)\r\n\r\nSELECT\r\n\r\n    PS.Upload_Date    ,\r\n\r\n    PS.project_id    ,\r\n\r\n    PS.tower    ,\r\n\r\n    PS.`Level`    ,\r\n\r\n    PS.Flat    ,\r\n\r\n    PS.sclicer    ,\r\n\r\n    CASE\r\n\r\n        WHEN PS.value IN ('','NA') THEN '0%'\r\n\r\n        ELSE PS.value\r\n\r\n    END AS value,\r\n\r\n    PS.Type_of_work    ,\r\n\r\n    PS.ACTIVITY_ID    ,\r\n\r\n    PS.SBU_ID    ,\r\n\r\n    PS.Category    ,\r\n\r\n    OLMA.level_map\r\n\r\nFROM PRE_STAGGING PS\r\n\r\n    LEFT JOIN O_LEVEL_MAP_ALL OLMA\r\n\r\n        ON PS.`Level` = OLMA.`level`\r\n\r\nWHERE Project_Udate_DRANK = 1;\r\n\r\n /**/\r\n Select 1;",
						"queryTimeout": "02:00:00"
					},
					"dataset": {
						"referenceName": "DS_MySQL_Data_Loads_DB",
						"type": "DatasetReference"
					}
				}
			},
			{
				"name": "Wet Area Template",
				"type": "Lookup",
				"dependsOn": [
					{
						"activity": "Kitchen Area Template",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "AzureMySqlSource",
						"query": "TRUNCATE TABLE f_pln_wetarea;\r\nINSERT INTO f_pln_wetarea\r\nWITH PRE_STAGGING AS (\r\n\r\n    SELECT\r\n\r\n        DATE(O_PLN_WETAREA_RAW.upload_time) AS Upload_Date,\r\n\r\n        O_PLN_WETAREA_RAW.project_id,\r\n\r\n        O_PLN_WETAREA_RAW.tower,\r\n\r\n        O_PLN_WETAREA_RAW.`Level`,\r\n\r\n        O_PLN_WETAREA_RAW.Flat,\r\n\r\n        'Wet Area' AS sclicer,\r\n\r\n        Column_Name.*,\r\n\r\n        O_PLN_WETAREA_MAP.ACTIVITY_ID,\r\n\r\n        O_PLN_WETAREA_MAP.SBU_ID,\r\n\r\n        O_PLN_WETAREA_MAP.Category,\r\n\r\n        DENSE_RANK () OVER (PARTITION BY  project_id\r\n\r\n                                ORDER BY  DATE(upload_time) DESC\r\n\r\n                                )   AS  Project_Udate_DRANK\r\n\r\n    from O_PLN_WETAREA_RAW\r\n\r\n    cross join lateral (\r\n\r\n                SELECT `Plastering Clearance with 1 Mtr Marking`             ,               'Plastering Clearance with 1 Mtr Marking'\r\n\r\nUNION ALL SELECT           `Wet Area Tile Marking` ,               'Wet Area Tile Marking'\r\n\r\nUNION ALL SELECT           `MEP Marking`  ,               'MEP Marking'\r\n\r\nUNION ALL SELECT           `Wet Area Cutting & Chasing`      ,               'Wet Area Cutting & Chasing'\r\n\r\nUNION ALL SELECT           `Pex pipe installation`     ,               'Pex pipe installation'\r\n\r\nUNION ALL SELECT           `Re packing of MEP Services`       ,               'Re packing of MEP Services'\r\n\r\nUNION ALL SELECT           `MEP Pipe installation - Borepacking`      ,               'MEP Pipe installation - Borepacking'\r\n\r\nUNION ALL SELECT           `Wet Area Bore Packing`               ,               'Wet Area Bore Packing'\r\n\r\nUNION ALL SELECT           `Cistern installation`        ,               'Cistern installation'\r\n\r\nUNION ALL SELECT           `Drywall framing`             ,               'Drywall framing'\r\n\r\nUNION ALL SELECT           `Pex Elbow & Connections`          ,               'Pex Elbow & Connections'\r\n\r\nUNION ALL SELECT           `Bottom Boarding Clearance`      ,               'Bottom Boarding Clearance'\r\n\r\nUNION ALL SELECT           `Bottom boarding`           ,               'Bottom boarding'\r\n\r\nUNION ALL SELECT           `Under Screed Waterproofing`   ,               'Under Screed Waterproofing'\r\n\r\nUNION ALL SELECT           `Wet Area Screed`           ,               'Wet Area Screed'\r\n\r\nUNION ALL SELECT           `Ledge Wall Full Board Closure Clearance`             ,               'Ledge Wall Full Board Closure Clearance'\r\n\r\nUNION ALL SELECT           `MEP HL Water Supply & Drainage`          ,               'MEP HL Water Supply & Drainage '\r\n\r\nUNION ALL SELECT           `MEP HL Ducting & FCU Works`  ,               'MEP HL Ducting & FCU Works '\r\n\r\nUNION ALL SELECT           `MEP HL Electrical Services Installation`  ,               'MEP HL Electrical Services Installation'\r\n\r\nUNION ALL SELECT           `MEP HL Works & Testing`            ,               'MEP HL Works & Testing'\r\n\r\nUNION ALL SELECT           `MEP HL Packing Clearance`         ,               'MEP HL Packing Clearance'\r\n\r\nUNION ALL SELECT           `Packing for all builders work opening`   ,               'Packing for all builders work opening '\r\n\r\nUNION ALL SELECT           `Wet Area MEP H/L Fire Sealent & Framing Clearance`     ,               'Wet Area MEP H/L Fire Sealent & Framing Clearance '\r\n\r\nUNION ALL SELECT           `Wet area Wall Tile`         ,               'Wet area Wall Tile'\r\n\r\nUNION ALL SELECT           `Wet Area FC Framing`   ,               'Wet Area FC Framing'\r\n\r\nUNION ALL SELECT           `Wet Area MEP H/L Boarding Clearance` ,               'Wet Area MEP H/L Boarding Clearance'\r\n\r\nUNION ALL SELECT           `FC Boarding & Joint Taping`        ,               'FC Boarding & Joint Taping'\r\n\r\nUNION ALL SELECT           `Ceiling Paint Primer`      ,               'Ceiling Paint Primer'\r\n\r\nUNION ALL SELECT           `Ceiling Paint Stucco 1st Coat & 2nd Coat`             ,               'Ceiling Paint Stucco 1st Coat & 2nd Coat'\r\n\r\nUNION ALL SELECT           `Wet Area Ceiling First Coat Paint`            ,               'Wet Area Ceiling First Coat Paint'\r\n\r\nUNION ALL SELECT           `MEP Grill & Diffuser Installtion` ,               'MEP Grill & Diffuser Installtion '\r\n\r\nUNION ALL SELECT           `Shower Threshold`         ,               'Shower Threshold'\r\n\r\nUNION ALL SELECT           `Linear Drain Supply`      ,               'Linear Drain Supply'\r\n\r\nUNION ALL SELECT           `Linear Drain Fixing`        ,               'Linear Drain Fixing '\r\n\r\nUNION ALL SELECT           `Under Tile Waterproofing`         ,               'Under Tile Waterproofing'\r\n\r\nUNION ALL SELECT           `Bathroom Door Threshold`         ,               'Bathroom Door Threshold'\r\n\r\nUNION ALL SELECT           `Wet Area Floor Tile`       ,               'Wet Area Floor Tile'\r\n\r\nUNION ALL SELECT           `Wall tile bottom Tile`     ,               'Wall tile bottom Tile'\r\n\r\nUNION ALL SELECT           `Grouting - Wall & Floor`               ,               'Grouting - Wall & Floor'\r\n\r\nUNION ALL SELECT           `Silicone - Wall & Floor Corners` ,               'Silicone - Wall & Floor Corners'\r\n\r\nUNION ALL SELECT           `Shower Partition - U channel`    ,               'Shower Partition - U channel'\r\n\r\nUNION ALL SELECT           `Shower Partition - Glass`             ,               'Shower Partition - Glass'\r\n\r\nUNION ALL SELECT           `Accessories & Silicon`    ,               'Accessories & Silicon'\r\n\r\nUNION ALL SELECT           `Bathroom Door - Frame Installation`      ,               'Bathroom Door - Frame Installation'\r\n\r\nUNION ALL SELECT           `Bathroom Door - Architrave Installation`              ,               'Bathroom Door - Architrave Installation'\r\n\r\nUNION ALL SELECT           `Bathroom Door - Shutter Installation`    ,               'Bathroom Door - Shutter Installation'\r\n\r\nUNION ALL SELECT           `Bathroom Door - Ironmongery Installation`         ,               'Bathroom Door - Ironmongery Installation'\r\n\r\nUNION ALL SELECT           `Vanity Cabinet` ,               'Vanity Cabinet'\r\n\r\nUNION ALL SELECT           `Vanity Cabinet Counter top`       ,               'Vanity Cabinet Counter top'\r\n\r\nUNION ALL SELECT           `MEP Final Fixtures (Sanitary ,CP fittings & Lights,WB)`    ,               'MEP Final Fixtures (Sanitary ,CP fittings & Lights,WB)'\r\n\r\nUNION ALL SELECT           `MEP Ledge Wall Clearance`        ,               'MEP Ledge Wall Clearance '\r\n\r\nUNION ALL SELECT           `Ledge Wall Closing`        ,               'Ledge Wall Closing'\r\n\r\nUNION ALL SELECT           `Silicone around MEP Fixtures`   ,               'Silicone around MEP Fixtures'\r\n\r\nUNION ALL SELECT           `Wet Area Final Coat paint`          ,               'Wet Area Final Coat paint'\r\n\r\n \r\n\r\n            )\r\n\r\n              as Column_Name(value,Type_of_work)\r\n\r\n        JOIN O_PLN_WETAREA_MAP\r\n\r\n        ON Column_Name.Type_of_work = O_PLN_WETAREA_MAP.ACTIVITY_SEQUENCE\r\n\r\n        WHERE value IS NOT NULL)\r\n\r\nSELECT\r\n\r\n    PS.Upload_Date    ,\r\n\r\n    PS.project_id    ,\r\n\r\n    PS.tower    ,\r\n\r\n    PS.`Level`    ,\r\n\r\n    PS.Flat    ,\r\n\r\n    PS.sclicer    ,\r\n\r\n    CASE\r\n\r\n        WHEN PS.value IN ('','NA','-') THEN '0%'\r\n\r\n        ELSE PS.value\r\n\r\n    END AS value,\r\n\r\n    PS.Type_of_work    ,\r\n\r\n    PS.ACTIVITY_ID    ,\r\n\r\n    PS.SBU_ID    ,\r\n\r\n    PS.Category    ,\r\n\r\n    OLMA.level_map\r\n\r\nFROM PRE_STAGGING PS\r\n\r\n    LEFT JOIN O_LEVEL_MAP_ALL OLMA\r\n\r\n        ON PS.`Level` = OLMA.`level`\r\n\r\nWHERE Project_Udate_DRANK = 1;\r\n\r\n/**/\r\n\r\nSELECT 1;",
						"queryTimeout": "02:00:00"
					},
					"dataset": {
						"referenceName": "DS_MySQL_Data_Loads_DB",
						"type": "DatasetReference"
					}
				}
			},
			{
				"name": "Balcony Area Template",
				"type": "Lookup",
				"dependsOn": [
					{
						"activity": "Wet Area Template",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "AzureMySqlSource",
						"query": "TRUNCATE TABLE f_pln_balconyarea;\r\nINSERT INTO f_pln_balconyarea\r\nWITH PRE_STAGGING AS (\r\n\r\n    SELECT DATE(O_PLN_BALCONYAREA_RAW.upload_time) AS Upload_Date,\r\n\r\n        O_PLN_BALCONYAREA_RAW.project_id,\r\n\r\n        O_PLN_BALCONYAREA_RAW.tower,\r\n\r\n        O_PLN_BALCONYAREA_RAW.`Level`,\r\n\r\n        O_PLN_BALCONYAREA_RAW.Flat,\r\n\r\n        'Balcony Area' AS sclicer,\r\n\r\n        Column_Name.*,\r\n\r\n        O_PLN_BALCONYAREA_MAP.ACTIVITY_ID,\r\n\r\n        O_PLN_BALCONYAREA_MAP.SBU_ID,\r\n\r\n        O_PLN_BALCONYAREA_MAP.Category,\r\n\r\n        DENSE_RANK () OVER (PARTITION BY  project_id\r\n\r\n                            ORDER BY  DATE(upload_time) DESC\r\n\r\n                            ) AS Project_Udate_DRANK\r\n\r\n    from O_PLN_BALCONYAREA_RAW\r\n\r\n    cross join lateral (\r\n\r\n                SELECT `Marking for Rain Water Pipe`    ,               'Marking for Rain Water Pipe'\r\n\r\nUNION ALL SELECT           `Rain water pipe`              ,               'Rain water pipe'\r\n\r\nUNION ALL SELECT           `Rain Water Pipe Packing`             ,               'Rain Water Pipe Packing'\r\n\r\nUNION ALL SELECT           `Balcony Blockwork`        ,               'Balcony Blockwork'\r\n\r\nUNION ALL SELECT           `Balcony Plaster`               ,               'Balcony Plaster'\r\n\r\nUNION ALL SELECT           `F channel Installation`   ,               'F channel Installation'\r\n\r\nUNION ALL SELECT           `Non Shrink Grout`          ,               'Non Shrink Grout'\r\n\r\nUNION ALL SELECT           `Top Rail Bracket Installation`      ,               'Top Rail Bracket Installation'\r\n\r\nUNION ALL SELECT           `EIFS Installation`              ,               'EIFS Installation'\r\n\r\nUNION ALL SELECT           `Balcony EIFS Plaster`     ,               'Balcony EIFS Plaster'\r\n\r\nUNION ALL SELECT           `Grinding Clearance`       ,               'Grinding Clearance'\r\n\r\nUNION ALL SELECT           `Ceiling Skim Coat & Primer`        ,               'Ceiling Skim Coat & Primer'\r\n\r\nUNION ALL SELECT           `Balcony Screed`               ,               'Balcony Screed'\r\n\r\nUNION ALL SELECT           `Drain Fixing`      ,               'Drain Fixing'\r\n\r\nUNION ALL SELECT           `Ceiling Balcony Box Installation`               ,               'Ceiling Balcony Box Installation'\r\n\r\nUNION ALL SELECT           `Left Over Screed (If any)`             ,               'Left Over Screed (If any)'\r\n\r\nUNION ALL SELECT           `EIFS Wall Texture`          ,               'EIFS Wall Texture'\r\n\r\nUNION ALL SELECT           `Balustrade Glass Installation`     ,               'Balustrade Glass Installation'\r\n\r\nUNION ALL SELECT           `Balustrade Top Rail`       ,               'Balustrade Top Rail'\r\n\r\nUNION ALL SELECT           `Balcony Under Tile Water Proofing`        ,               'Balcony Under Tile Water Proofing'\r\n\r\nUNION ALL SELECT           `Balcony Floor Tiling`       ,               'Balcony Floor Tiling'\r\n\r\nUNION ALL SELECT           `Balustrade - Internal Flashing`   ,               'Balustrade - Internal Flashing'\r\n\r\nUNION ALL SELECT           `Balcony Skirting`              ,               'Balcony Skirting'\r\n\r\nUNION ALL SELECT           `Metal Ceiling`   ,               'Metal Ceiling'\r\n\r\nUNION ALL SELECT           `Balcony Ceiling Texture`              ,               'Balcony Ceiling Texture'\r\n\r\nUNION ALL SELECT           `Complete Wall Texture`               ,               'Complete Wall Texture'\r\n\r\nUNION ALL SELECT           `Balcony Grouting`           ,               'Balcony Grouting'\r\n\r\nUNION ALL SELECT           `Balcony Silicone`             ,               'Balcony Silicone'\r\n\r\nUNION ALL SELECT           `Balcony MEP Final Fixtures`       ,               'Balcony MEP Final Fixtures'\r\n\r\nUNION ALL SELECT           `Balcony Final Coat Paint`             ,               'Balcony Final Coat Paint'\r\n\r\nUNION ALL SELECT           `Balcony Drain Cover Supply`      ,               'Balcony Drain Cover Supply'\r\n\r\nUNION ALL SELECT           `Cover fixing for balcony drain`   ,               'Cover fixing for balcony drain'\r\n\r\nUNION ALL SELECT           `Cover plate B/W ACP & EIFS`     ,               'Cover plate B/W ACP & EIFS'\r\n\r\n \r\n\r\n        )\r\n\r\n        as Column_Name(value,Type_of_work)\r\n\r\n    JOIN O_PLN_BALCONYAREA_MAP\r\n\r\n    ON Column_Name.Type_of_work = O_PLN_BALCONYAREA_MAP.ACTIVITY_SEQUENCE\r\n\r\n    WHERE value IS NOT NULL\r\n\r\n    AND value !='')\r\n\r\nSELECT\r\n\r\n    PS.Upload_Date    ,\r\n\r\n    PS.project_id    ,\r\n\r\n    PS.tower    ,\r\n\r\n    PS.`Level`    ,\r\n\r\n    PS.Flat    ,\r\n\r\n    PS.sclicer    ,\r\n\r\n    CASE\r\n\r\n        WHEN PS.value IN ('','NA','-') THEN '0%'\r\n\r\n        ELSE PS.value\r\n\r\n    END AS value,\r\n\r\n    PS.Type_of_work    ,\r\n\r\n    PS.ACTIVITY_ID    ,\r\n\r\n    PS.SBU_ID    ,\r\n\r\n    PS.Category    ,\r\n\r\n    OLMA.level_map\r\n\r\nFROM PRE_STAGGING PS\r\n\r\n    LEFT JOIN O_LEVEL_MAP_ALL OLMA\r\n\r\n        ON PS.`Level` = OLMA.`level`\r\n\r\nWHERE Project_Udate_DRANK = 1;\r\n\r\n/**/\r\n\r\nSELECT 1;",
						"queryTimeout": "02:00:00"
					},
					"dataset": {
						"referenceName": "DS_MySQL_Data_Loads_DB",
						"type": "DatasetReference"
					}
				}
			},
			{
				"name": "FlatWise",
				"type": "Lookup",
				"dependsOn": [
					{
						"activity": "Balcony Area Template",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "AzureMySqlSource",
						"query": "TRUNCATE TABLE f_pln_flatfinishes;\r\nINSERT INTO f_pln_flatfinishes\r\nWITH UNION_ALL AS (\r\n        SELECT * FROM F_PLN_DRYAREA\r\n            UNION ALL\r\n        SELECT * FROM F_PLN_WETAREA\r\n            UNION ALL\r\n        SELECT * FROM F_PLN_BALCONYAREA\r\n            UNION ALL\r\n        SELECT * FROM F_PLN_KITCHENAREA\r\n                ),\r\n    UNION_CLEAN AS (\r\n        SELECT \r\n        UA.Upload_Date,\r\n            UA.project_id,\r\n            UA.tower,\r\n            UA.`Level`,\r\n            UA.Flat,\r\n            UA.sclicer,\r\n            CASE \r\n                WHEN UA.value IN ('','NA','TBC','-','#N/A') THEN '0%'\r\n                ELSE UA.value\r\n            END AS value,\r\n            UA.Type_of_work,\r\n            UA.ACTIVITY_ID,\r\n            UA.SBU_ID,\r\n            UA.Category,\r\n            CONCAT(UA.ACTIVITY_ID,' ', UA.Type_of_work) AS sort_type_of_work \r\n        FROM \r\n        UNION_ALL UA),\r\n    STAGGING AS (\r\n        SELECT\r\n            UA.Upload_Date,\r\n            UA.project_id,\r\n            UA.tower,\r\n            UA.`Level`,\r\n            UA.Flat,\r\n            UA.sclicer,\r\n            CAST(REPLACE(UA.value,'%','') AS DECIMAL)/100 AS value,\r\n            UA.Type_of_work,\r\n            UA.ACTIVITY_ID,\r\n            UA.SBU_ID,\r\n            UA.Category,\r\n            OLMA.level_map,\r\n            CONCAT(UA.ACTIVITY_ID,' ', UA.Type_of_work) AS sort_type_of_work\r\n        FROM UNION_CLEAN UA\r\n            LEFT JOIN O_LEVEL_MAP_ALL OLMA ON UA.`Level` = OLMA.`level`\r\n        WHERE LENGTH(value) <= 4)\r\n    SELECT\r\n        *,\r\n        CASE WHEN sclicer = 'Dry Area' THEN 1\r\n            WHEN sclicer = 'Wet Area' THEN 2\r\n            WHEN sclicer = 'Kitchen Area' THEN 3\r\n           WHEN sclicer = 'Balcony Area' THEN 4\r\n        END AS Sort_Slicer,\r\n        CASE \r\n            WHEN    TRIM(Category) =     ('MEP')    THEN    1\r\n            WHEN    TRIM(Category) =     ('Blockwork')    THEN    2\r\n            WHEN    TRIM(Category) =     ('Plaster')    THEN    3\r\n            WHEN    TRIM(Category) =     ('Builders Work')    THEN    4\r\n            WHEN    TRIM(Category) =     ('Facade')    THEN    5\r\n            WHEN    TRIM(Category) =     ('Tile')    THEN    6\r\n            WHEN    TRIM(Category) =     ('Screed')    THEN    7\r\n            WHEN    TRIM(Category) =     ('Paint')    THEN    8\r\n            WHEN    TRIM(Category) =     ('Gypsum')    THEN    9\r\n            WHEN    TRIM(Category) =     ('Marble')    THEN    10\r\n            WHEN    TRIM(Category) =     ('Silicone')    THEN    11\r\n            WHEN    TRIM(Category) =     ('Joinery')    THEN    12\r\n            WHEN    TRIM(Category) =     ('SBU1')    THEN    13\r\n            WHEN    TRIM(Category) =     ('Waterproofing')    THEN    14\r\n            WHEN    TRIM(Category) =     ('Fa�ade')    THEN    15\r\n            WHEN    TRIM(Category) =     ('EIFS')    THEN    16\r\n            WHEN    TRIM(Category) =     ('SFD')    THEN    17\r\n            WHEN    TRIM(Category) =     ('Water Proofing')    THEN    18\r\n            WHEN    TRIM(Category) =     ('Appliances')    THEN    19\r\n        END AS Category_Sort        \r\n    FROM STAGGING\r\n    ORDER BY value;\r\n\r\n    /**/\r\n\r\n    SELECT 1;",
						"queryTimeout": "02:00:00"
					},
					"dataset": {
						"referenceName": "DS_MySQL_Data_Loads_DB",
						"type": "DatasetReference"
					}
				}
			}
		],
		"annotations": [],
		"lastPublishTime": "2023-01-01T12:06:38Z"
	},
	"type": "Microsoft.DataFactory/factories/pipelines"
}